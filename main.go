package main

import (
	"fmt"
	"os"

	"github.com/consensys/gnark/frontend"
	"github.com/consensys/gnark/std/math/uints"
	gnark_nimue "github.com/reilabs/gnark-nimue"
	go_ark_serialize "github.com/reilabs/go-ark-serialize"
)

type Circuit struct {
	IOPattern            []frontend.Variable     `gnark:"Input output pattern for the protocol. Used to seed the initial sponge"`
	MerkleRoot           []frontend.Variable     `gnark:"Merkle root for the Reed-Solomon encoding of the polynomial"`
	First_OOD_Answer     []frontend.Variable     `gnark:"First out-of-domain query answer"`
	Evaluation           frontend.Variable       `gnark:"Supposed evaluation for the Verifier query"`
	SumcheckPolysAsEvals [][][]frontend.Variable `gnark:"Quadratic sumcheck polynomials in their evaluation form (Evaluated over 0, 1, 2)"`
	FoldingParameter     int
}

type KeccakDigest struct {
	KeccakDigest [32]uint8
}

type Fp256 struct {
	Limbs [4]uint64
}

type MultiPath[Digest any] struct {
	LeafSiblingHashes      []Digest
	AuthPathsPrefixLengths []uint64
	AuthPathsSuffixes      [][]Digest
	LeafIndexes            []uint64
}

type ProofElement struct {
	A MultiPath[KeccakDigest]
	B [][]Fp256
}

func main() {
	f, err := os.Open("../whir/proof")
	if err != nil {
		fmt.Println(err)
		return
	}
	defer f.Close()
	var x []ProofElement
	_, err = go_ark_serialize.CanonicalDeserializeWithMode(f, &x, false, false)

	IOPat := "ðŸŒª\ufe0f\u0000A1merkle_digest\u0000S1ood_query\u0000A1ood_ans\u0000S1initial_combination_randomness\u0000A3sumcheck_poly\u0000S1folding_randomness\u0000A3sumcheck_poly\u0000S1folding_randomness\u0000A1merkle_digest\u0000S1ood_query\u0000A1ood_ans\u0000S17stir_queries\u0000S3pow_queries\u0000A8pow-nonce\u0000S1combination_randomness\u0000A3sumcheck_poly\u0000S1folding_randomness\u0000A3sumcheck_poly\u0000S1folding_randomness\u0000A1merkle_digest\u0000S1ood_query\u0000A1ood_ans\u0000S9stir_queries\u0000S3pow_queries\u0000A8pow-nonce\u0000S1combination_randomness\u0000A3sumcheck_poly\u0000S1folding_randomness\u0000A3sumcheck_poly\u0000S1folding_randomness\u0000A1merkle_digest\u0000S1ood_query\u0000A1ood_ans\u0000S6stir_queries\u0000S3pow_queries\u0000A8pow-nonce\u0000S1combination_randomness\u0000A3sumcheck_poly\u0000S1folding_randomness\u0000A3sumcheck_poly\u0000S1folding_randomness\u0000A1merkle_digest\u0000S1ood_query\u0000A1ood_ans\u0000S3stir_queries\u0000S3pow_queries\u0000A8pow-nonce\u0000S1combination_randomness\u0000A3sumcheck_poly\u0000S1folding_randomness\u0000A3sumcheck_poly\u0000S1folding_randomness\u0000A1merkle_digest\u0000S1ood_query\u0000A1ood_ans\u0000S3stir_queries\u0000S3pow_queries\u0000A8pow-nonce\u0000S1combination_randomness\u0000A3sumcheck_poly\u0000S1folding_randomness\u0000A3sumcheck_poly\u0000S1folding_randomness\u0000A1merkle_digest\u0000S1ood_query\u0000A1ood_ans\u0000S2stir_queries\u0000S3pow_queries\u0000A8pow-nonce\u0000S1combination_randomness\u0000A3sumcheck_poly\u0000S1folding_randomness\u0000A3sumcheck_poly\u0000S1folding_randomness\u0000A1merkle_digest\u0000S1ood_query\u0000A1ood_ans\u0000S2stir_queries\u0000S3pow_queries\u0000A8pow-nonce\u0000S1combination_randomness\u0000A3sumcheck_poly\u0000S1folding_randomness\u0000A3sumcheck_poly\u0000S1folding_randomness\u0000A1merkle_digest\u0000S1ood_query\u0000A1ood_ans\u0000S2stir_queries\u0000S3pow_queries\u0000A8pow-nonce\u0000S1combination_randomness\u0000A3sumcheck_poly\u0000S1folding_randomness\u0000A3sumcheck_poly\u0000S1folding_randomness\u0000A1merkle_digest\u0000S1ood_query\u0000A1ood_ans\u0000S2stir_queries\u0000S3pow_queries\u0000A8pow-nonce\u0000S1combination_randomness\u0000A3sumcheck_poly\u0000S1folding_randomness\u0000A3sumcheck_poly\u0000S1folding_randomness\u0000A1final_coeffs\u0000S2final_queries\u0000S3pow_queries\u0000A8pow-nonce"
	io := gnark_nimue.IOPattern{}
	_ = io.Parse([]byte(IOPat))
	fmt.Printf("io: %s\n", io.PPrint())

	transcriptBytes := [2672]byte{187, 247, 53, 88, 35, 170, 195, 58, 160, 34, 145, 235, 106, 160, 6, 136, 167, 94, 58, 202, 232, 124, 132, 51, 39, 83, 213, 67, 21, 44, 107, 30, 248, 57, 247, 151, 128, 82, 224, 198, 184, 232, 128, 110, 128, 225, 57, 200, 106, 230, 17, 64, 107, 100, 131, 249, 0, 169, 89, 97, 138, 140, 149, 2, 65, 79, 119, 83, 136, 127, 84, 42, 54, 169, 221, 219, 218, 88, 131, 96, 209, 159, 92, 117, 136, 138, 9, 183, 177, 160, 246, 182, 99, 212, 35, 37, 184, 234, 127, 52, 140, 200, 109, 224, 19, 176, 92, 12, 238, 112, 234, 143, 246, 158, 54, 76, 153, 31, 202, 250, 120, 168, 148, 139, 153, 6, 214, 13, 125, 82, 137, 111, 58, 89, 116, 34, 26, 239, 214, 62, 125, 84, 93, 133, 241, 242, 110, 162, 30, 116, 155, 8, 98, 202, 134, 153, 73, 89, 88, 32, 19, 205, 31, 130, 52, 213, 166, 13, 119, 154, 88, 43, 197, 5, 61, 144, 122, 146, 152, 113, 10, 91, 55, 106, 13, 201, 158, 119, 82, 114, 177, 22, 0, 12, 17, 110, 88, 104, 68, 56, 151, 122, 130, 242, 81, 16, 201, 209, 97, 251, 41, 140, 145, 147, 78, 36, 250, 14, 42, 54, 71, 231, 132, 18, 200, 119, 81, 157, 52, 120, 120, 252, 16, 57, 158, 129, 99, 230, 197, 189, 14, 235, 136, 4, 135, 130, 211, 0, 185, 47, 255, 176, 114, 160, 130, 2, 129, 201, 74, 68, 158, 160, 160, 97, 50, 3, 32, 234, 202, 130, 58, 119, 142, 78, 166, 23, 255, 70, 84, 154, 3, 68, 212, 193, 219, 10, 160, 19, 10, 141, 201, 96, 19, 206, 1, 230, 104, 246, 101, 44, 169, 190, 116, 132, 130, 250, 221, 140, 45, 87, 139, 62, 214, 123, 37, 84, 206, 113, 255, 29, 0, 0, 0, 0, 0, 8, 139, 254, 162, 108, 9, 191, 193, 170, 29, 31, 39, 185, 46, 184, 113, 76, 96, 39, 177, 241, 154, 123, 142, 17, 202, 121, 75, 120, 133, 40, 7, 120, 126, 26, 103, 132, 195, 99, 32, 182, 124, 114, 17, 26, 241, 204, 222, 230, 51, 178, 208, 14, 20, 127, 163, 184, 127, 85, 20, 35, 57, 88, 151, 244, 226, 47, 249, 118, 130, 157, 122, 180, 191, 255, 197, 7, 89, 62, 152, 160, 249, 224, 32, 183, 67, 185, 159, 240, 25, 93, 193, 84, 25, 115, 96, 21, 101, 39, 69, 104, 31, 217, 104, 87, 169, 228, 64, 143, 14, 67, 31, 244, 117, 99, 182, 42, 174, 159, 27, 51, 122, 148, 137, 170, 61, 175, 47, 156, 74, 34, 2, 7, 89, 183, 214, 14, 78, 160, 110, 79, 193, 82, 71, 55, 232, 193, 203, 24, 167, 126, 153, 37, 141, 36, 108, 167, 90, 160, 24, 176, 109, 7, 57, 90, 2, 152, 134, 224, 31, 66, 175, 56, 108, 221, 202, 39, 138, 235, 227, 16, 55, 160, 203, 134, 253, 92, 27, 82, 183, 185, 169, 46, 201, 11, 17, 58, 170, 102, 128, 43, 66, 116, 232, 180, 127, 19, 123, 128, 64, 35, 255, 226, 31, 232, 107, 120, 185, 151, 98, 194, 126, 238, 144, 79, 9, 35, 43, 53, 105, 16, 178, 77, 200, 10, 39, 46, 196, 77, 39, 38, 37, 169, 69, 73, 170, 75, 162, 193, 247, 247, 122, 6, 73, 45, 217, 61, 140, 3, 0, 0, 0, 0, 0, 0, 67, 82, 174, 147, 55, 10, 230, 92, 158, 180, 202, 23, 133, 71, 252, 107, 115, 81, 8, 240, 38, 21, 154, 75, 115, 142, 248, 119, 119, 150, 135, 229, 73, 28, 239, 91, 194, 16, 123, 177, 126, 207, 250, 39, 215, 32, 203, 243, 24, 251, 42, 123, 148, 124, 175, 32, 223, 152, 254, 227, 201, 109, 137, 62, 121, 4, 160, 118, 246, 129, 112, 184, 127, 232, 91, 203, 21, 68, 206, 129, 170, 63, 48, 252, 148, 44, 182, 231, 54, 140, 27, 8, 205, 138, 95, 42, 24, 41, 86, 66, 95, 95, 94, 199, 59, 34, 110, 89, 121, 113, 28, 14, 152, 247, 58, 45, 114, 37, 23, 120, 99, 206, 249, 19, 5, 180, 211, 177, 203, 36, 18, 67, 48, 78, 164, 152, 97, 55, 18, 64, 80, 85, 137, 5, 177, 221, 208, 247, 155, 68, 71, 243, 159, 140, 229, 153, 240, 5, 104, 23, 116, 15, 44, 236, 181, 23, 252, 104, 129, 49, 101, 162, 190, 82, 131, 255, 240, 246, 58, 29, 143, 99, 245, 128, 169, 170, 64, 235, 205, 107, 140, 213, 94, 36, 96, 47, 7, 9, 41, 46, 255, 200, 206, 61, 217, 71, 198, 13, 151, 248, 176, 108, 117, 50, 114, 180, 118, 129, 143, 150, 90, 233, 115, 159, 241, 32, 243, 12, 77, 33, 84, 56, 253, 40, 117, 117, 21, 231, 203, 198, 112, 207, 185, 240, 210, 187, 5, 116, 145, 234, 82, 34, 157, 36, 156, 207, 71, 29, 0, 0, 0, 0, 0, 0, 36, 65, 26, 50, 16, 235, 77, 181, 50, 156, 177, 36, 7, 117, 99, 101, 41, 135, 189, 250, 94, 243, 33, 152, 140, 58, 92, 74, 13, 34, 185, 139, 213, 5, 36, 204, 40, 32, 18, 202, 107, 157, 136, 226, 53, 109, 61, 252, 254, 21, 40, 146, 147, 222, 82, 227, 216, 20, 93, 57, 16, 10, 20, 29, 197, 2, 112, 19, 66, 21, 112, 100, 165, 68, 98, 41, 186, 212, 181, 153, 168, 127, 230, 247, 100, 21, 51, 3, 17, 225, 178, 124, 239, 56, 164, 135, 153, 45, 155, 39, 105, 223, 53, 18, 88, 81, 32, 70, 195, 53, 175, 188, 51, 217, 151, 198, 101, 159, 244, 184, 98, 20, 180, 182, 114, 19, 187, 64, 212, 0, 244, 109, 189, 23, 16, 23, 237, 14, 173, 35, 86, 232, 53, 172, 144, 61, 235, 36, 8, 1, 38, 80, 180, 204, 128, 222, 25, 76, 45, 71, 195, 0, 234, 156, 69, 121, 102, 77, 92, 215, 31, 18, 173, 2, 211, 20, 234, 27, 130, 24, 63, 175, 233, 231, 69, 115, 140, 133, 133, 115, 19, 117, 61, 42, 54, 103, 226, 26, 188, 13, 52, 158, 190, 87, 43, 254, 112, 42, 69, 109, 139, 99, 249, 124, 145, 137, 152, 127, 36, 113, 253, 88, 209, 204, 109, 26, 219, 188, 42, 136, 156, 117, 139, 174, 168, 71, 117, 248, 134, 204, 105, 102, 117, 116, 62, 239, 240, 86, 204, 124, 116, 237, 45, 25, 180, 193, 78, 11, 0, 0, 0, 0, 0, 0, 191, 55, 92, 203, 209, 102, 107, 8, 32, 17, 152, 226, 138, 250, 79, 213, 141, 143, 3, 142, 49, 157, 193, 147, 227, 149, 106, 200, 187, 222, 128, 82, 255, 44, 95, 236, 38, 231, 177, 63, 232, 173, 180, 40, 232, 115, 186, 207, 187, 206, 169, 0, 114, 164, 157, 239, 249, 229, 238, 122, 23, 220, 136, 63, 239, 16, 13, 170, 115, 18, 169, 235, 106, 99, 198, 138, 95, 215, 235, 169, 249, 234, 44, 248, 178, 74, 55, 80, 116, 25, 119, 202, 52, 4, 110, 51, 97, 46, 9, 79, 145, 39, 131, 224, 133, 5, 152, 69, 189, 123, 97, 38, 45, 97, 96, 73, 251, 70, 151, 157, 40, 244, 128, 149, 247, 143, 197, 88, 153, 5, 241, 28, 92, 108, 42, 136, 195, 128, 152, 192, 252, 202, 171, 159, 59, 215, 110, 141, 66, 68, 234, 157, 108, 81, 194, 204, 200, 55, 155, 127, 128, 25, 152, 203, 75, 116, 85, 59, 78, 130, 143, 236, 21, 81, 222, 103, 191, 108, 167, 3, 241, 240, 27, 236, 101, 164, 203, 130, 173, 211, 176, 96, 232, 33, 187, 6, 13, 128, 130, 66, 196, 117, 181, 68, 112, 221, 135, 179, 200, 216, 49, 11, 222, 77, 77, 243, 86, 61, 212, 188, 171, 136, 54, 199, 72, 10, 190, 150, 245, 34, 195, 127, 246, 235, 246, 205, 197, 228, 224, 116, 190, 11, 120, 69, 24, 235, 117, 171, 136, 197, 110, 216, 93, 80, 40, 228, 178, 28, 0, 0, 0, 0, 0, 0, 72, 107, 84, 56, 90, 140, 16, 82, 9, 175, 64, 37, 238, 8, 11, 237, 250, 75, 30, 49, 186, 171, 86, 0, 178, 180, 143, 25, 33, 194, 38, 13, 252, 17, 196, 213, 231, 104, 112, 131, 17, 19, 115, 248, 125, 97, 133, 56, 113, 6, 250, 128, 125, 100, 156, 51, 24, 139, 216, 120, 246, 170, 202, 152, 143, 24, 171, 148, 239, 156, 149, 205, 73, 105, 61, 13, 65, 202, 15, 112, 0, 147, 73, 46, 61, 40, 188, 59, 111, 243, 53, 52, 26, 250, 210, 99, 82, 41, 212, 243, 69, 237, 177, 228, 96, 66, 225, 162, 93, 97, 55, 117, 4, 185, 10, 48, 100, 235, 226, 47, 134, 67, 229, 89, 21, 225, 140, 58, 88, 47, 211, 219, 95, 152, 210, 255, 72, 42, 137, 135, 6, 28, 221, 235, 80, 71, 182, 122, 152, 233, 239, 222, 189, 123, 136, 58, 186, 154, 175, 195, 208, 35, 202, 50, 175, 1, 238, 157, 30, 248, 174, 2, 119, 115, 110, 184, 205, 217, 196, 115, 194, 48, 251, 136, 104, 32, 172, 25, 220, 66, 218, 125, 150, 22, 92, 92, 136, 77, 234, 160, 46, 141, 122, 31, 116, 70, 205, 241, 243, 11, 63, 188, 174, 73, 26, 4, 149, 152, 190, 85, 149, 116, 46, 107, 8, 19, 135, 194, 99, 6, 253, 1, 109, 31, 46, 101, 56, 35, 94, 96, 223, 105, 212, 233, 64, 33, 8, 41, 163, 131, 245, 29, 75, 79, 151, 117, 225, 18, 0, 0, 0, 0, 0, 1, 50, 216, 86, 76, 127, 141, 43, 167, 131, 236, 108, 24, 55, 228, 111, 114, 137, 249, 20, 249, 43, 200, 65, 227, 69, 132, 216, 21, 81, 250, 250, 21, 39, 26, 93, 199, 151, 119, 152, 19, 241, 201, 120, 181, 74, 14, 231, 146, 144, 81, 202, 248, 255, 86, 222, 156, 69, 12, 56, 233, 20, 58, 23, 249, 194, 24, 147, 61, 116, 19, 87, 231, 71, 52, 26, 4, 154, 64, 81, 107, 0, 245, 168, 244, 238, 245, 72, 110, 167, 39, 229, 234, 81, 119, 20, 11, 99, 28, 7, 50, 85, 179, 124, 124, 159, 1, 122, 232, 184, 163, 164, 227, 84, 247, 108, 229, 23, 171, 163, 155, 154, 131, 105, 227, 118, 45, 40, 97, 177, 30, 119, 164, 183, 84, 72, 172, 254, 87, 254, 95, 25, 178, 120, 161, 41, 247, 95, 48, 77, 11, 243, 8, 181, 128, 144, 61, 218, 154, 57, 97, 249, 47, 100, 127, 230, 226, 230, 168, 190, 121, 38, 48, 186, 205, 118, 150, 67, 106, 85, 114, 27, 167, 4, 207, 149, 208, 169, 150, 55, 154, 188, 225, 184, 15, 59, 38, 57, 161, 173, 236, 174, 37, 252, 71, 163, 180, 123, 51, 101, 23, 151, 235, 66, 70, 25, 181, 115, 189, 119, 109, 231, 224, 13, 122, 138, 25, 244, 208, 189, 210, 68, 87, 206, 160, 12, 71, 178, 129, 211, 29, 119, 110, 168, 24, 11, 141, 242, 198, 136, 222, 72, 82, 124, 220, 7, 138, 119, 9, 0, 0, 0, 0, 0, 0, 99, 228, 221, 71, 190, 249, 141, 67, 129, 34, 83, 29, 25, 141, 71, 138, 104, 0, 133, 242, 73, 240, 164, 172, 135, 225, 188, 108, 226, 64, 21, 21, 253, 16, 179, 22, 236, 8, 169, 142, 76, 164, 92, 87, 136, 192, 208, 51, 119, 162, 218, 28, 56, 67, 195, 221, 16, 216, 28, 255, 163, 105, 103, 6, 223, 23, 19, 29, 67, 58, 176, 147, 109, 104, 8, 132, 87, 84, 175, 186, 123, 113, 133, 109, 216, 169, 161, 109, 131, 230, 153, 178, 26, 62, 104, 43, 157, 5, 67, 192, 52, 78, 59, 105, 61, 147, 56, 93, 157, 248, 206, 153, 219, 187, 229, 207, 53, 55, 203, 9, 235, 178, 161, 164, 196, 56, 117, 116, 82, 47, 151, 41, 182, 232, 185, 72, 246, 9, 252, 175, 66, 89, 81, 60, 123, 31, 24, 74, 103, 123, 225, 58, 68, 117, 250, 63, 67, 193, 49, 102, 197, 33, 77, 223, 232, 207, 169, 33, 243, 189, 35, 59, 149, 110, 26, 127, 224, 158, 133, 191, 193, 255, 225, 212, 162, 128, 173, 235, 154, 46, 204, 26, 173, 40, 3, 39, 26, 159, 52, 30, 7, 55, 15, 198, 13, 30, 199, 152, 154, 74, 4, 148, 154, 122, 32, 31, 232, 170, 246, 97, 198, 52, 105, 141, 20, 39, 156, 240, 33, 31, 13, 26, 47, 70, 121, 156, 166, 87, 229, 74, 48, 244, 55, 166, 186, 216, 82, 53, 8, 80, 170, 169, 102, 65, 132, 148, 160, 12, 0, 0, 0, 0, 0, 0, 10, 156, 81, 220, 81, 82, 181, 63, 227, 98, 199, 51, 41, 110, 227, 169, 234, 229, 40, 37, 74, 21, 103, 50, 35, 19, 42, 175, 25, 127, 242, 52, 86, 26, 47, 249, 54, 140, 78, 17, 89, 233, 129, 223, 59, 4, 132, 99, 39, 16, 185, 54, 204, 136, 119, 99, 84, 211, 99, 51, 164, 166, 67, 145, 133, 18, 238, 249, 203, 12, 145, 77, 152, 218, 224, 58, 186, 218, 57, 42, 83, 252, 55, 132, 87, 147, 183, 242, 89, 240, 73, 205, 9, 246, 234, 18, 114, 44, 55, 185, 168, 219, 68, 155, 68, 102, 22, 209, 87, 10, 240, 73, 235, 77, 104, 96, 28, 160, 47, 206, 181, 225, 242, 92, 92, 99, 232, 123, 31, 26, 143, 98, 108, 56, 103, 12, 174, 248, 14, 242, 68, 140, 73, 119, 161, 39, 110, 81, 249, 205, 82, 69, 133, 150, 48, 24, 10, 19, 60, 140, 53, 48, 79, 188, 85, 236, 4, 196, 9, 49, 186, 75, 231, 41, 61, 197, 119, 160, 204, 253, 54, 73, 163, 181, 235, 95, 12, 172, 68, 234, 56, 239, 127, 16, 193, 91, 141, 239, 230, 90, 240, 81, 255, 217, 160, 123, 235, 87, 115, 38, 78, 190, 214, 7, 41, 107, 115, 90, 166, 127, 19, 25, 164, 215, 198, 33, 193, 131, 142, 238, 97, 60, 254, 161, 224, 197, 109, 80, 130, 202, 207, 30, 106, 106, 22, 241, 140, 211, 246, 188, 176, 112, 164, 158, 79, 211, 44, 4, 0, 0, 0, 0, 0, 0, 5, 168, 222, 151, 97, 132, 81, 88, 223, 6, 251, 193, 227, 190, 11, 210, 68, 1, 228, 170, 174, 224, 144, 194, 151, 210, 68, 228, 154, 116, 100, 53, 113, 16, 146, 247, 25, 184, 211, 134, 56, 108, 210, 60, 156, 165, 96, 195, 127, 156, 2, 13, 117, 16, 92, 84, 188, 235, 233, 127, 194, 188, 184, 226, 74, 10, 112, 202, 116, 45, 149, 44, 40, 199, 157, 180, 114, 29, 64, 42, 87, 127, 241, 84, 85, 166, 18, 66, 166, 56, 52, 245, 147, 53, 162, 61, 231, 22, 140, 11, 212, 50, 34, 254, 15, 141, 48, 184, 39, 223, 78, 229, 185, 201, 17, 179, 73, 154, 239, 190, 1, 62, 245, 207, 171, 254, 153, 159, 111, 8, 171, 139, 140, 201, 221, 79, 205, 222, 246, 41, 96, 206, 255, 75, 95, 220, 137, 162, 199, 202, 211, 198, 206, 128, 219, 158, 110, 236, 227, 28, 147, 43, 205, 137, 141, 138, 90, 141, 231, 46, 0, 34, 90, 163, 54, 112, 8, 140, 176, 161, 63, 87, 127, 71, 222, 25, 91, 98, 172, 1, 213, 216, 164, 27, 45, 135, 112, 248, 78, 50, 107, 49, 152, 61, 44, 86, 144, 223, 208, 147, 144, 254, 161, 165, 247, 236, 72, 146, 140, 83, 136, 242, 180, 176, 123, 45, 0, 0, 0, 0, 0, 0, 2, 187}
	println(len(transcriptBytes))
	transcript := [2672]uints.U8{}

	for i := range transcriptBytes {
		transcript[i] = uints.NewU8(transcriptBytes[i])
	}

	verify_circuit(x, IOPat, transcript)
}
